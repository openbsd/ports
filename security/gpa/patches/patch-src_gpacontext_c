From 45fc64a4ac9f73457bf610ce76cca087c0d0d09a Mon Sep 17 00:00:00 2001
From: Sam James via Gnupg-devel <gnupg-devel@gnupg.org>
Date: Sun, 10 Aug 2025 03:36:11 +0100
Subject: [PATCH] Fix incorrect callback arguments

From b6ba8bcc6db7765667cd6c49b7edc9a2073bc74f Mon Sep 17 00:00:00 2001
From: Werner Koch <wk@gnupg.org>
Date: Fri, 18 Jul 2025 09:45:23 +0200
Subject: [PATCH] Remove trust_item stuff to make it build with gpgme 2.x

Index: src/gpacontext.c
--- src/gpacontext.c.orig
+++ src/gpacontext.c
@@ -25,6 +25,7 @@
 #include "gpa.h"
 #include "gpgmetools.h"
 #include "gpacontext.h"
+#include "gpa-marshal.h"
 
 /* GObject type functions */
 
@@ -38,8 +39,6 @@ static void gpa_context_finalize (GObject *object);
 static void gpa_context_start (GpaContext *context);
 static void gpa_context_done (GpaContext *context, gpg_error_t err);
 static void gpa_context_next_key (GpaContext *context, gpgme_key_t key);
-static void gpa_context_next_trust_item (GpaContext *context,
-                                         gpgme_trust_item_t item);
 static void gpa_context_progress (GpaContext *context, int current, int total);
 
 /* The GPGME I/O callbacks */
@@ -65,7 +64,6 @@ enum
   START,
   DONE,
   NEXT_KEY,
-  NEXT_TRUST_ITEM,
   PROGRESS,
   LAST_SIGNAL
 };
@@ -113,7 +111,6 @@ gpa_context_class_init (GpaContextClass *klass)
   klass->start = gpa_context_start;
   klass->done = gpa_context_done;
   klass->next_key = gpa_context_next_key;
-  klass->next_trust_item = gpa_context_next_trust_item;
   klass->progress = gpa_context_progress;
 
   /* Signals */
@@ -143,24 +140,15 @@ gpa_context_class_init (GpaContextClass *klass)
                         g_cclosure_marshal_VOID__POINTER,
                         G_TYPE_NONE, 1,
 			G_TYPE_POINTER);
-  signals[NEXT_TRUST_ITEM] =
-          g_signal_new ("next_trust_item",
-                        G_TYPE_FROM_CLASS (object_class),
-                        G_SIGNAL_RUN_FIRST,
-                        G_STRUCT_OFFSET (GpaContextClass, next_trust_item),
-                        NULL, NULL,
-                        g_cclosure_marshal_VOID__POINTER,
-                        G_TYPE_NONE, 1,
-			G_TYPE_POINTER);
   signals[PROGRESS] =
           g_signal_new ("progress",
                         G_TYPE_FROM_CLASS (object_class),
                         G_SIGNAL_RUN_FIRST,
                         G_STRUCT_OFFSET (GpaContextClass, progress),
                         NULL, NULL,
-                        g_cclosure_marshal_VOID__INT,
+                        gpa_marshal_VOID__INT_INT,
                         G_TYPE_NONE, 2,
-			G_TYPE_INT);
+			G_TYPE_INT, G_TYPE_INT);
 }
 
 static void
@@ -496,10 +484,6 @@ gpa_context_event_cb (void *data, gpgme_event_io_t typ
     case GPGME_EVENT_NEXT_KEY:
       g_signal_emit (context, signals[NEXT_KEY], 0, type_data);
       break;
-    case GPGME_EVENT_NEXT_TRUSTITEM:
-      g_signal_emit (context, signals[NEXT_TRUST_ITEM], 0,
-                     type_data);
-      break;
     default:
       /* Ignore unsupported event types */
       break;
@@ -527,12 +511,6 @@ gpa_context_done (GpaContext *context, gpg_error_t err
 
 static void
 gpa_context_next_key (GpaContext *context, gpgme_key_t key)
-{
-  /* Do nothing yet */
-}
-
-static void
-gpa_context_next_trust_item (GpaContext *context, gpgme_trust_item_t item)
 {
   /* Do nothing yet */
 }
