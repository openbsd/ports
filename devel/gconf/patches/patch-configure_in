$OpenBSD: patch-configure_in,v 1.3 2004/10/10 18:20:17 naddy Exp $
--- configure.in.orig	Fri Mar 15 05:09:32 2002
+++ configure.in	Sat Oct  9 23:35:06 2004
@@ -140,6 +140,13 @@ if test "x$docs_only" = "xyes"; then
         AC_FYI("Only building documentation")
 else
 
+AC_CHECK_HEADERS(sys/socket.h)
+
+dnl use xml headers from gnome-xml if they exist
+AC_CHECK_HEADERS(gnome-xml/tree.h gnome-xml/parser.h gnome-xml/entities.h gnome-xml/xmlmemory.h )
+
+AC_CHECK_HEADERS(sys/socket.h)
+
 AC_CHECK_LIB(popt, poptGetArg, POPT_LIBS=-lpopt,
 	[AC_CHECK_HEADER(popt.h, , AC_MSG_ERROR([[
 *** Couldn't find popt. Please download and install from
@@ -167,20 +174,31 @@ AC_SUBST(XML_CFLAGS)
 BDB_LIBS=
 BDB_CFLAGS=
 
-
-for dblib in db-3.3 db-3.2 db-3.1 db-3; do
-  AC_CHECK_LIB($dblib, db_env_create, BDB_LIBS=-l$dblib)
-  if test "x$BDB_LIBS" != x; then
-    break
+AC_ARG_ENABLE(db3,
+  [  --enable-db3=[no/yes]   build bdb backend],[
+  if test "x$enable_db3" = "xyes"; then
+  for dblib in db-3.3 db-3.2 db-3.1 db-3 db; do
+    AC_CHECK_LIB($dblib, db_env_create, BDB_LIBS=-l$dblib)
+    if test "x$BDB_LIBS" != x; then
+      break
+    fi
+  done
+  if test "x$BDB_LIBS" = x; then
+    AC_MSG_WARN(No db3 library found. Not building bdb backend.)
+  else
+    for dbheader in "db3/db.h db3.h"; do
+      AC_CHECK_HEADERS($dbheader, [
+        HAVE_BDBHEADER=yes
+        break
+      ], )
+    done
+    if test "x$HAVE_BDBHEADER" = x; then
+      AC_MSG_ERROR(Found db3 lib but no db3 header)
+    fi
   fi
-done
+  fi
+  ],)
 
-if test "x$BDB_LIBS" = x; then
-  AC_MSG_WARN(No db3 library found. Not building bdb backend.)
-else
-  AC_CHECK_HEADERS(db3/db.h,  , AC_MSG_ERROR([db3 library found but db3/db.h not found]))
-fi
-
 AM_CONDITIONAL(BDB, test -n "$BDB_LIBS")
 
 AC_SUBST(BDB_LIBS)
@@ -223,6 +241,7 @@ fi # docs_only
 
 ALL_LINGUAS="az ca cs da de el es eu fi fr ga gl hu it ja ko nl nn no pl pt pt_BR ru sk sl sv tr uk zh_CN"
 
+LIBS="-liconv ${LIBS}"
 AM_GCONF_GNU_GETTEXT
 
 # AM_GNU_GETTEXT above substs $DATADIRNAME
