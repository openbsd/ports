$OpenBSD: patch-configure,v 1.44 2008/02/18 16:37:38 espie Exp $
--- configure.orig	Sun Oct  7 21:49:33 2007
+++ configure	Mon Feb 18 17:25:13 2008
@@ -76,7 +76,7 @@ cc_check() {
 }
 
 cxx_check() {
-  compile_check $TMPCPP $@ -lstdc++
+  compile_check $TMPCPP $@ -lstdc++ -lm
 }
 
 tmp_run() {
@@ -501,7 +501,7 @@ _libavcodec_a=auto
 _libamr_nb=auto
 _libamr_wb=auto
 _libavdecoders_all=`sed -n 's/^[^#]*DEC.*(.*, *\(.*\)).*/\1_decoder/p' libavcodec/allcodecs.c | tr '[a-z]' '[A-Z]'`
-_libavdecoders=` echo $_libavdecoders_all | sed -e s/LIBFAAD_DECODER// -e s/MPEG4AAC_DECODER//  -e s/LIBA52_DECODER// -e s/LIBGSM_DECODER// -e s/LIBGSM_MS_DECODER// -e s/LIBVORBIS_DECODER// `
+_libavdecoders=` echo $_libavdecoders_all | sed -e s/LIBFAAD_DECODER// -e s/MPEG4AAC_DECODER//  -e s/LIBA52_DECODER// -e s/LIBGSM_DECODER// -e s/LIBGSM_MS_DECODER// -e s/LIBVORBIS_DECODER// -e s/VORBIS_DECODER// `
 _libavencoders_all=`sed -n 's/^[^#]*ENC.*(.*, *\(.*\)).*/\1_encoder/p' libavcodec/allcodecs.c | tr '[a-z]' '[A-Z]'`
 _libavencoders=` echo $_libavencoders_all | sed -e s/LIBGSM_ENCODER// -e s/LIBGSM_MS_ENCODER// -e s/LIBTHEORA_ENCODER// `
 _libavparsers_all=`sed -n 's/^[^#]*PARSER.*(.*, *\(.*\)).*/\1_parser/p' libavcodec/allcodecs.c | tr '[a-z]' '[A-Z]'`
@@ -1557,6 +1557,8 @@ if x86 ; then
   pparam=`echo $exts | sed -e s/k6_mtrr/mtrr/ -e s/cyrix_arr/mtrr/ -e s/centaur_mcr/mtrr/ \
                            -e s/xmm/sse/ -e s/kni/sse/`
 
+  if x86_64 ; then pparam="3dnow 3dnowext mmx mmxext xmm sse sse2" ; fi
+
   for ext in $pparam ; do
     eval test \"\$_$ext\" = auto 2>/dev/null && eval _$ext=kernel_check
   done
@@ -3065,7 +3067,7 @@ int main(void) { pthread_t tid; return pthread_create 
 EOF
 _pthreads=no
 if not hpux ; then
-  for _ld_tmp in "-lpthreadGC2" "" "-lpthread" "-pthread" ; do
+  for _ld_tmp in "-lpthreadGC2" "" "-pthread" "-lpthread" ; do
     # for crosscompilation, we cannot execute the program, be happy if we can link statically
     cc_check $_ld_tmp && (tmp_run || test "$_ld_static") && _ld_pthread="$_ld_tmp" && _pthreads=yes && break
   done
@@ -3108,7 +3110,7 @@ fi
 echores "$_rpath"
 
 echocheck "iconv"
-if test "$_iconv" = auto ; then
+if test "$_iconv" != no ; then
   cat > $TMPC << EOF
 #include <stdio.h>
 #include <unistd.h>
@@ -4369,6 +4371,8 @@ if test "$_aa" = yes ; then
   _def_aa='#define HAVE_AA 1'
   if cygwin ; then
     _libs_mplayer="$_libs_mplayer `aalib-config --libs | cut -d " " -f 2,5,6`"
+  else
+    _libs_mplayer="$_libs_mplayer -laa"
   fi
   _vosrc="$_vosrc vo_aa.c"
   _vomodules="aa $_vomodules"
@@ -4576,7 +4580,7 @@ fi
 echores "$_png"
 if test "$_png" = yes ; then
   _def_png='#define HAVE_PNG 1'
-  _ld_extra="$_ld_extra -lpng -lz"
+  _ld_extra="$_ld_extra -lpng -lz $_ld_lm"
   _vosrc="$_vosrc vo_png.c"
   _vomodules="png $_vomodules"
 else
@@ -5054,7 +5058,7 @@ if test "$_arts" = yes ; then
   _def_arts='#define USE_ARTS 1'
   _aosrc="$_aosrc ao_arts.c"
   _aomodules="arts $_aomodules"
-  _libs_mplayer="$_libs_mplayer `artsc-config --libs`"
+  _libs_mplayer="$_libs_mplayer `artsc-config --libs` -lstdc++"
   _inc_extra="$_inc_extra `artsc-config --cflags`"
 else
   _noaomodules="arts $_noaomodules"
@@ -5343,7 +5347,7 @@ fi #if irix
 
 
 echocheck "VCD support"
-if linux || bsdos || freebsd || netbsd || sunos || darwin || mingw32; then
+if linux || bsdos || freebsd || netbsd || sunos || darwin || mingw32 || openbsd ; then
   _inputmodules="vcd $_inputmodules"
   _def_vcd='#define HAVE_VCD 1'
   _vcd="yes"
@@ -5592,7 +5596,7 @@ int main()
 }
 EOF
   _fontconfig=no
-  for _ld_tmp in "" "-lexpat -lfreetype" "-lexpat -lfreetype -lz" ; do
+  for _ld_tmp in "" "-lexpat -lfreetype" "-lexpat -lfreetype -lz $_ld_lm" ; do
     _ld_tmp="-lfontconfig $_ld_tmp"
     cc_check $_ld_tmp && _fontconfig=yes && _ld_extra="$_ld_extra $_ld_tmp" && break
   done
@@ -5704,10 +5708,10 @@ cat > $TMPC << EOF
 int main(void) { (void) inflate(0, Z_NO_FLUSH); return 0; }
 EOF
 _zlib=no
-cc_check -lz && _zlib=yes
+cc_check "-lz $_ld_lm" && _zlib=yes
 if test "$_zlib" = yes ; then
   _def_zlib='#define HAVE_ZLIB 1'
-  _ld_extra="$_ld_extra -lz"
+  _ld_extra="$_ld_extra -lz $_ld_lm"
 else
   _def_zlib='#undef HAVE_ZLIB'
   _libavdecoders=`echo $_libavdecoders | sed -e s/FLASHSV_DECODER// -e s/PNG_DECODER// -e s/ZMBV_DECODER// -e s/DXA_DECODER// `
@@ -6207,7 +6211,7 @@ if test "$_real" = auto ; then
   _real=no
   _res_comment="dynamic loader support needed"
   if test "$_dl" = yes || test "$_win32dll" = yes &&
-     (linux || freebsd || netbsd || win32 || darwin) ; then
+     (linux || freebsd || netbsd || openbsd || win32 || darwin) ; then
     _real=yes
   fi
 fi
