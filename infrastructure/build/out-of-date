#!/bin/sh
# $OpenBSD: out-of-date,v 1.4 2001/03/07 03:41:10 form Exp $
# Copyright (c) 1999
# Marc Espie.  All rights reserved.
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Neither the name of OpenBSD nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY ITS AUTHOR AND THE OpenBSD project ``AS IS'' AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
# OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
# OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.

# Check for simple discrepancies between installed packages and the
# /usr/ports INDEX

FILE=/usr/ports/INDEX

cat <<EOF
>>> Is /usr/ports/INDEX up-to-date ?
>>> Otherwise, this script will find out outdated flavors of packages
>>> compared to your installed packages...
EOF
pkg_info |while read fullname rest
do
	grep "^$fullname" $FILE >/dev/null || {
		basename=`echo $fullname |sed -e 's/^\(.*\)-.*/\1/'`
		newname=`grep "^$basename-" $FILE |cut -f1 -d\|`
		if [ X"$newname" == X ]
		then
			basename=`echo $basename |sed -e 's/^\(.*\)-.*/\1/'`
			newname=`grep "^$basename-" $FILE |cut -f1 -d\|`
		fi
		# some packages exist in several distinct flavors
		if [ `echo $newname| wc -w` -ge 2 ]
		then
			echo -n "Update $fullname to one of "
			echo $newname|while read item
				do
					echo -n "$item "
				done
			echo ""
		else
			if [ -n "$newname" ]; then
				echo "Update $fullname to $newname"
			else
				echo "$fullname not in INDEX"
			fi
		fi
		}
done

