$OpenBSD: patch-security_manager_ssl_src_nsNSSCallbacks_cpp,v 1.1 2011/03/24 11:41:11 landry Exp $
https://bugzilla.mozilla.org/show_bug.cgi?id=644012
--- security/manager/ssl/src/nsNSSCallbacks.cpp.orig	Sat Mar 19 20:02:41 2011
+++ security/manager/ssl/src/nsNSSCallbacks.cpp	Thu Mar 24 10:53:49 2011
@@ -1005,8 +1005,11 @@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
   nsNSSShutDownPreventionLock locker;
 
   CERTCertificate *serverCert = SSL_PeerCertificate(fd);
+  CERTCertificateCleaner serverCertCleaner(serverCert);
+
   if (serverCert && 
       serverCert->serialNumber.data &&
+      serverCert->issuerName &&
       !strcmp(serverCert->issuerName, 
         "CN=UTN-USERFirst-Hardware,OU=http://www.usertrust.com,O=The USERTRUST Network,L=Salt Lake City,ST=UT,C=US")) {
 
@@ -1049,8 +1052,6 @@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
   // We want to remember the CA certs in the temp db, so that the application can find the
   // complete chain at any time it might need it.
   // But we keep only those CA certs in the temp db, that we didn't already know.
-  
-  CERTCertificateCleaner serverCertCleaner(serverCert);
 
   if (serverCert) {
     nsNSSSocketInfo* infoObject = (nsNSSSocketInfo*) fd->higher->secret;
