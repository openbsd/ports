$OpenBSD: patch-nsprpub_pr_src_misc_prnetdb_c,v 1.2 2004/11/01 10:25:12 sturm Exp $
--- nsprpub/pr/src/misc/prnetdb.c.orig	Fri Oct 31 06:09:29 2003
+++ nsprpub/pr/src/misc/prnetdb.c	Mon Nov  1 07:33:55 2004
@@ -98,6 +98,7 @@ PRLock *_pr_dnsLock = NULL;
 #endif
 
 #if defined(OSF1) \
+	|| defined(OPENBSD) \
         || defined(AIX4_3_PLUS) || (defined(AIX) && defined(_THREAD_SAFE)) \
 	|| (defined(HPUX10_10) && defined(_REENTRANT)) \
         || (defined(HPUX10_20) && defined(_REENTRANT))
@@ -2094,7 +2095,12 @@ PR_IMPLEMENT(PRAddrInfo *) PR_GetAddrInf
          */
         hints.ai_socktype = SOCK_STREAM;
 
+	LOCK_DNS();
+
         rv = GETADDRINFO(hostname, NULL, &hints, &res);
+
+	UNLOCK_DNS();
+
         if (rv == 0)
             return (PRAddrInfo *) res;
 
