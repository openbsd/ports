$OpenBSD: patch-src_plugins_oss_ao_oss_c,v 1.1.1.1 2001/03/14 01:54:09 todd Exp $
--- src/plugins/oss/ao_oss.c.orig	Sat Feb 24 02:31:48 2001
+++ src/plugins/oss/ao_oss.c	Tue Mar 13 15:27:15 2001
@@ -113,28 +113,15 @@ ao_internal_t *plugin_open(uint_32 bits,
 		}
 	} else {
 		/* default: first try the devfs path */
-		state->dev = strdup("/dev/sound/dsp");
+		state->dev = strdup("/dev/sound");
 		state->fd=open(state->dev,O_WRONLY);
 		if(state->fd < 0) 
 		{
-			/* no? then try the traditional path */
-			char *err = strdup(strerror(errno));
-			char *dev = strdup(state->dev);
-			free(state->dev);
-			state->dev = strdup("/dev/dsp");
-			state->fd=open(state->dev,O_WRONLY);
-			if(state->fd < 0) 
-			{
-				fprintf(stderr,
-					"libao - error: Could not open either default device:\n"
-					"  %s - %s\n"
-					"  %s - %s\n",
-					err, dev,
-					strerror(errno), state->dev);
-				free(err);
-				free(dev);
-				goto ERR;
-			}
+			fprintf(stderr,
+				"libao - error: Could not open default device:\n",
+				"  %s - %s\n",
+				strerror(errno), state->dev);
+			goto ERR;
 		}
 	}
 
@@ -198,7 +185,9 @@ void plugin_close(ao_internal_t *state)
 int plugin_get_latency(ao_internal_t *state)
 {
 	int odelay = 0;
+#ifdef SNDCTL_DSP_GETODELAY
 	ioctl(((ao_oss_internal_t *)state)->fd, SNDCTL_DSP_GETODELAY, &odelay);
+#endif
 	return odelay;
 }
 
