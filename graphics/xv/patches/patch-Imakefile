--- Imakefile.orig	Mon Apr 11 23:39:27 2005
+++ Imakefile	Mon Apr 11 23:40:00 2005
@@ -6,15 +6,24 @@
 /* if, for whatever reason, you're unable to get the JPEG library to compile
  * on your machine, *COMMENT OUT* the following line
  */
-#define HaveJpeg
+/* #define HaveJpeg */
+#define UseInstalledJpeg
 
 
 /* if, for whatever reason, you're unable to get the TIFF library to compile
  * on your machine, *COMMENT OUT* the following line
  */
-#define HaveTiff
+/* #define HaveTiff */
+#define UseInstalledTiff
 
 
+/* if, for whatever reason, you're unable to get the NNG library to compile
+ * on your machine, *COMMENT OUT* the following line
+ */
+/* #define HavePng */
+#define UseInstalledPng
+
+
 /* if, for whatever reason, you're unable to get the PDS/VICAR support
  * to compile (xvpds.c, and vdcomp.c), *COMMENT OUT* the following line
  */
@@ -35,7 +44,7 @@
 /* If your machine has the 'usleep()' function, uncomment the following
  * line.  If it doesn't, or you're not sure, don't uncomment the line
  */
-/* TIMERS = -DUSLEEP */
+TIMERS = -DUSLEEP
 
 /* if XV locks up whenever you click any button in the controls window,
  * the Timer() function in xvmisc.c is going out-to-lunch.  A simple
@@ -119,16 +128,44 @@
 JPEG = -DDOJPEG
 JPEGDIR = jpeg
 LIBJPEG = $(JPEGDIR)/libjpeg.a
+DEPLIBJPEG = $(LIBJPEG)
 JPEGINCLUDE = -I$(JPEGDIR)
 #endif
 
+#ifdef UseInstalledJpeg
+JPEG = -DDOJPEG
+LIBJPEG = -L/usr/local/lib -ljpeg
+JPEGINCLUDE = -I/usr/local/include
+#endif
+
 #ifdef HaveTiff
 TIFF = -DDOTIFF
 TIFFDIR = tiff
 LIBTIFF = $(TIFFDIR)/libtiff.a
+DEPLIBTIFF = $(LIBTIFF)
 TIFFINCLUDE = -I$(TIFFDIR)
 #endif
 
+#ifdef UseInstalledTiff
+TIFF = -DDOTIFF
+LIBTIFF = -L/usr/local/lib -ltiff
+TIFFINCLUDE = -I/usr/local/include
+#endif
+
+#ifdef HavePng
+PNG    = -DDOPNG
+PNGDIR = png
+LIBPNG = $(PNGDIR)/libpng.a
+DEPLIBPNG = $(LIBPNG)
+PNGINCLUDE = -I$(PNGDIR)
+#endif
+
+#ifdef UseInstalledPng
+PNG = -DDOPNG
+LIBPNG = -L/usr/local/lib -lpng
+PNGINCLUDE = -I$(LOCALBASE)/include/libpng
+#endif
+
 #ifdef HavePDS
 PDS = -DDOPDS
 #endif
@@ -138,18 +175,18 @@
 SCO= -Dsco -DPOSIX -DNO_RANDOM 
 SYS_LIBRARIES=        -lm -lc -lx 
 #else
-SYS_LIBRARIES=        -lm
+SYS_LIBRARIES=        -lm -lz
 #endif
 
 
-DEPLIBS = $(LIBJPEG) $(LIBTIFF)
-LOCAL_LIBRARIES = $(XLIB) $(DEPLIBS)
+DEPLIBS = $(DEPLIBJPEG) $(DEPLIBTIFF) $(DEPLIBPNG)
+LOCAL_LIBRARIES = $(XLIB) $(LIBJPEG) $(LIBTIFF) $(LIBPNG)
 
 DEFINES= $(SCO) $(UNIX) $(NODIRENT) $(VPRINTF) $(TIMERS) \
-	$(HPUX7) $(JPEG) $(TIFF) $(PDS) $(DXWM) $(RAND) \
+	$(HPUX7) $(JPEG) $(TIFF) $(PNG) $(PDS) $(DXWM) $(RAND) \
 	$(BACKING_STORE) $(BSDTYPES) $(SGI)
 
-INCLUDES = $(JPEGINCLUDE) $(TIFFINCLUDE)
+INCLUDES = $(JPEGINCLUDE) $(TIFFINCLUDE) $(PNGINCLUDE)
 
 SRCS1 =	xv.c xvevent.c xvroot.c xvmisc.c xvimage.c xvcolor.c xvsmooth.c \
 	xv24to8.c xvgif.c xvpm.c xvinfo.c xvctrl.c xvscrl.c xvalg.c \
@@ -233,7 +270,19 @@
 #endif
 
 
+#ifdef HavePng
+$(LIBPNG):
+	cd $(PNGDIR); $(MAKE) libpng.a
+ 
+clean::
+	@echo "  cleaning in $(PNGDIR) ..."
+	@echo ""
+	( cd $(PNGDIR) ; $(MAKE) clean )
+	@echo ""
+#endif
 
+
+
 SRCS = $(SRCS1) $(SRCS2) $(SRCS3) $(SRCS4)
   
 AllTarget($(PROGRAMS))
@@ -268,5 +317,5 @@
 
 tar:
 	tar cf xv.tar Makefile* Imakefile *.c *.h bits docs \
-		 docs unsupt vms $(JPEGDIR) $(TIFFDIR) $(MISC)
+		 docs unsupt vms $(JPEGDIR) $(TIFFDIR) $(PNGDIR) $(MISC)
 
